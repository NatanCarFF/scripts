# Script: Gerenciar Inicializa√ß√£o do Windows
# Autor: Natanael (adaptado por ChatGPT)

Write-Host "üîç Listando programas de inicializa√ß√£o..." -ForegroundColor Cyan

# Fun√ß√£o para listar programas da inicializa√ß√£o
function Get-StartupPrograms {
    $startup = @()

    # Registro - Current User
    $startup += Get-ItemProperty "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" | 
        ForEach-Object { $_.PSObject.Properties | Where-Object { $_.Name -ne "PSPath" -and $_.Name -ne "PSParentPath" -and $_.Name -ne "PSChildName" -and $_.Name -ne "PSDrive" -and $_.Name -ne "PSProvider" } }

    # Registro - Local Machine
    $startup += Get-ItemProperty "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run" | 
        ForEach-Object { $_.PSObject.Properties | Where-Object { $_.Name -ne "PSPath" -and $_.Name -ne "PSParentPath" -and $_.Name -ne "PSChildName" -and $_.Name -ne "PSDrive" -and $_.Name -ne "PSProvider" } }

    # Pasta de inicializa√ß√£o do usu√°rio
    $userStartup = "$env:APPDATA\Microsoft\Windows\Start Menu\Programs\Startup"
    if (Test-Path $userStartup) {
        Get-ChildItem $userStartup | ForEach-Object {
            $startup += @{ Name = $_.Name; Value = $_.FullName }
        }
    }

    return $startup
}

$programas = Get-StartupPrograms
$i = 1

foreach ($p in $programas) {
    Write-Host "$i - $($p.Name) => $($p.Value)"
    $i++
}

if ($programas.Count -eq 0) {
    Write-Host "‚úÖ Nenhum programa configurado para inicializar automaticamente." -ForegroundColor Green
    exit
}

# Perguntar ao usu√°rio
$opcao = Read-Host "`nDigite o n√∫mero do programa que deseja gerenciar (ou 0 para sair)"

if ($opcao -eq 0) {
    Write-Host "‚ùå Saindo sem altera√ß√µes."
    exit
}

$selecionado = $programas[$opcao-1]

Write-Host "`nVoc√™ escolheu: $($selecionado.Name)"
$acao = Read-Host "Digite (D) para desativar ou (A) para ativar novamente (se j√° foi removido)"

switch ($acao.ToUpper()) {
    "D" {
        # Tenta remover das chaves de registro
        Remove-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name $selecionado.Name -ErrorAction SilentlyContinue
        Remove-ItemProperty -Path "HKLM:\Software\Microsoft\Windows\CurrentVersion\Run" -Name $selecionado.Name -ErrorAction SilentlyContinue

        # Se for um arquivo de atalho na pasta de inicializa√ß√£o, deleta
        if (Test-Path $selecionado.Value) {
            Remove-Item $selecionado.Value -Force
        }

        Write-Host "üü† Programa removido da inicializa√ß√£o." -ForegroundColor Yellow
    }
    "A" {
        $caminho = Read-Host "Digite o caminho do execut√°vel para adicionar √† inicializa√ß√£o"
        Set-ItemProperty -Path "HKCU:\Software\Microsoft\Windows\CurrentVersion\Run" -Name $selecionado.Name -Value "`"$caminho`""
        Write-Host "‚úÖ Programa adicionado de volta √† inicializa√ß√£o." -ForegroundColor Green
    }
    Default {
        Write-Host "‚ùå Op√ß√£o inv√°lida."
    }
}
